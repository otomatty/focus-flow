graph LR
    subgraph 目標設定
        A1(新規目標設定) --> A1_1{目標情報を入力};
        A1_1 -- 不備あり --> A1_2[エラーメッセージ表示];
        A1_1 -- 問題なし --> A1_3[目標を保存];
        A1_3 --> A1_4(目標保存完了);

        A2(既存目標の編集) --> A2_1{目標編集画面を開く};
        A2_1 --> A2_2{目標情報を修正};
        A2_2 -- 不備あり --> A2_3[エラーメッセージ表示];
        A2_2 -- 問題なし --> A2_4[変更を保存];
        A2_4 --> A2_5(目標更新完了);

        A3(目標の削除) --> A3_1{削除確認画面を開く};
        A3_1 -- 削除実行 --> A3_2[目標を削除];
        A3_1 -- キャンセル --> A3_3[削除キャンセル];
        A3_2 --> A3_4(目標削除完了);
    end

    subgraph 習慣管理
        B1(新規習慣設定 (目標設定時)) --> B1_1{習慣情報を入力};
        B1_1 -- 不備あり --> B1_2[エラーメッセージ表示];
        B1_1 -- 問題なし --> B1_3[習慣と目標を保存];
        B1_3 --> B1_4(習慣と目標保存完了);

        B2(新規習慣設定 (目標詳細画面)) --> B2_1{習慣設定画面を開く};
        B2_1 --> B2_2{習慣情報を入力};
        B2_2 -- 不備あり --> B2_3[エラーメッセージ表示];
        B2_2 -- 問題なし --> B2_4[習慣を保存し目標に関連付け];
        B2_4 --> B2_5(習慣保存と関連付け完了);

        B3(目標なしで習慣を設定) --> B3_1{習慣作成画面を開く};
        B3_1 --> B3_2{習慣情報を入力};
        B3_2 -- 不備あり --> B3_3[エラーメッセージ表示];
        B3_2 -- 問題なし --> B3_4[習慣を保存];
        B3_4 --> B3_5(習慣保存完了);

        B4(既存習慣の編集) --> B4_1{習慣編集画面を開く};
        B4_1 --> B4_2{習慣情報を修正};
        B4_2 -- 不備あり --> B4_3[エラーメッセージ表示];
        B4_2 -- 問題なし --> B4_4[変更を保存];
        B4_4 --> B4_5(習慣更新完了);

        B5(習慣の削除) --> B5_1{削除確認画面を開く};
        B5_1 -- 削除実行 --> B5_2[習慣を削除];
        B5_1 -- キャンセル --> B5_3[削除キャンセル];
        B5_2 --> B5_4(習慣削除完了);

        B6(習慣の実行記録) --> B6_1{実行状況を選択};
        B6_1 --> B6_2[実行記録を保存];
        B6_2 --> B6_3(実行記録保存完了);
    end

    subgraph AIを活用した習慣提案 (Gemini等)
        C1(新規目標設定時にAIによる習慣提案を受ける) --> C1_1{「習慣を提案してもらう」ボタンを押下};
        C1_1 --> C1_2[目標情報をAI基盤に送信];
        C1_2 --> C1_3[AI基盤が習慣候補を生成];
        C1_3 --> C1_4{習慣候補をリスト表示};
        C1_4 -- 採用 --> C1_5[習慣を保存し目標に関連付け];
        C1_4 -- 編集して採用 --> C1_6[習慣を編集し保存];
        C1_4 -- 拒否 --> C1_7[提案を終了];
        C1_5 --> C1_8(習慣保存と関連付け完了);
        C1_6 --> C1_9(習慣編集と保存完了);
        C1_2 -- 提案なし --> C1_10[エラーメッセージ表示];
        C1_2 -- 目標曖昧 --> C1_11[具体的な入力を促す];

        C2(既存の目標に対してAIによる習慣提案を受ける) --> C2_1{目標詳細画面で「習慣を提案してもらう」ボタンを押下};
        C2_1 --> C2_2[目標情報をAI基盤に送信];
        C2_2 --> C2_3[AI基盤が習慣候補を生成];
        C2_3 --> C2_4{習慣候補をリスト表示};
        C2_4 -- 採用 --> C2_5[習慣を保存し目標に関連付け];
        C2_4 -- 編集して採用 --> C2_6[習慣を編集し保存];
        C2_4 -- 拒否 --> C2_7[提案を終了];
        C2_5 --> C2_8(習慣保存と関連付け完了);
        C2_6 --> C2_9(習慣編集と保存完了);
        C2_2 -- 提案なし --> C2_10[エラーメッセージ表示];

        C3(AIによる習慣提案の再表示と調整) --> C3_1{「提案を再表示する」ボタンを押下};
        C3_1 --> C3_2[目標情報をAI基盤に送信];
        C3_2 --> C3_3[AI基盤が新たな習慣候補を生成];
        C3_3 --> C3_4{新たな習慣候補をリスト表示};
        C3_4 -- 採用 --> C3_5[習慣を保存し目標に関連付け];
        C3_4 -- 編集して採用 --> C3_6[習慣を編集し保存];
        C3_4 -- 再提案 --> C3_1;
        C3_4 -- 拒否 --> C3_7[提案を終了];
        C3_5 --> C3_8(習慣保存と関連付け完了);
        C3_6 --> C3_9(習慣編集と保存完了);
        C3_1 -- キーワード入力 --> C3_10[キーワードで絞り込み];
        C3_10 --> C3_2;
    end

    subgraph その他機能
        D2(習慣の検索とフィルタリング);
        D3(目標と習慣の関連付け/解除);
        D4(リマインダー設定);
        D5(進捗状況の確認);
    end